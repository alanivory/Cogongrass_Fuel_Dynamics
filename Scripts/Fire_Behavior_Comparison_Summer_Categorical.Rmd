---
title: "Fire Behavior Comparison"
author: "Alan Ivory"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, brms, readxl, parameters, gt, posterior, forcats, bayestestR, cowplot, patchwork)

# Set seed
set.seed(97)

fb <- read_excel("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/02_Fuel_Data/C1O2_FireData.xlsx")

# Remove rows with NA in S_ROS
fb <- fb %>%
  dplyr::filter(!is.na(S_ROS))


priors <- c(
  prior(normal(0, 1), class = "b"),
  prior(student_t(3, 0, 2), class = "sigma")
)
```


## GLMM Surface Rate of Spread
```{r GLMM_Sur_ROS, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")

S_ROS_model_student <- brm(
  S_ROS ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)

```

## Rate of Spread Model Comparison
```{r compare_S_ROS, echo=FALSE}
summary(S_ROS_model_student)

# Plot the posterior predictive checks
pp_check(S_ROS_model_student) +
  labs(title = "Posterior Predictive Check for Surface Rate of Spread Model") +
  theme_minimal()

```

## Surface Rate of Spread Table
```{r surface_rate_of_spread_table, echo=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
sros_draws_filtered <- as_draws_df(S_ROS_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
sros_diagnostics <- summarise_draws(
  sros_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
sros_estimates <- sros_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Pd` = max(mean(value > 0), mean(value < 0)),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
sros_summary_df <- left_join(sros_estimates, sros_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
sros_summary_df_cleaned <- sros_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Pd`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

sros_gt_table <- sros_summary_df_cleaned %>%
  mutate(Significant = Pd >= 0.95) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Pd", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Surface Rate of Spread")

# --- 6. Print ---
print(sros_gt_table)

# Save the final table to a Word document
gtsave(
  sros_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/S_ROS_Posterior_Table.docx"
)
```


## ROS Conditional Effects
```{r conditional_effects_S_ROS, echo=FALSE}
# Calculate conditional effects and extract the data frame
SROS_ce_Status <- conditional_effects(S_ROS_model_student, effects = "Status")
SROS_df_Status <- SROS_ce_Status[["Status"]]

# Re-level the factor for plotting
SROS_df_Status$Status <- factor(SROS_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(SROS_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Surface Rate of Spread by Invasion Status",
    x = "Invasion Status",
    y = expression("Surface Rate of Spread (m min"^-1*")"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "steelblue", "Invaded" = "coral")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```




## GLMM Flame Length
```{r GLMM_Sur_FL, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")

S_FL_model_student <- brm(
  S_FL ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)

```

## Flame Length Model Comparison
```{r compare_S_FL, echo=FALSE}
summary(S_FL_model_student)

# Plot the posterior predictive checks
pp_check(S_FL_model_student) +
  labs(title = "Posterior Predictive Check for Surface Flame Length Model") +
  theme_minimal()

```

## Surface Flame Length Table
```{r surface_flame_length_table, echo=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
sfl_draws_filtered <- as_draws_df(S_FL_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
sfl_diagnostics <- summarise_draws(
  sfl_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
sfl_estimates <- sfl_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Pd` = max(mean(value > 0), mean(value < 0)),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
sfl_summary_df <- left_join(sfl_estimates, sfl_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
sfl_summary_df_cleaned <- sfl_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Pd`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

sfl_gt_table <- sfl_summary_df_cleaned %>%
  mutate(Significant = Pd >= 0.95) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Pd", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Surface Flame Length")

# Print the table
print(sfl_gt_table)

# Save the final table to a Word document
gtsave(
  sfl_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/S_FL_Posterior_Table.docx"
)
```


## Flame Length Conditional Effects
```{r conditional_effects_S_FL, echo=FALSE}
# Calculate conditional effects and extract the data frame
SFL_ce_Status <- conditional_effects(S_FL_model_student, effects = "Status")
SFL_df_Status <- SFL_ce_Status[["Status"]]

# Re-level the factor for plotting
SFL_df_Status$Status <- factor(SFL_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(SFL_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Surface Flame Length by Invasion Status",
    x = "Invasion Status",
    y = expression("Surface Flame Length (m)"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```




## GLMM Surface Fireline Intensity
```{r GLMM_Sur_FI, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")

S_Fin_model_student <- brm(
  S_Fin ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)

```


## Fireline Intensity Model Comparison
```{r compare_S_FI, echo=FALSE}
summary(S_Fin_model_student)

# Plot the posterior predictive checks
pp_check(S_Fin_model_student) +
  labs(title = "Posterior Predictive Check for Surface Fireline Intensity Model") +
  theme_minimal()

```

## Surface Fireline Intensity Table
```{r surface_fireline_intensity_table, echo=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
sfin_draws_filtered <- as_draws_df(S_Fin_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
sfin_diagnostics <- summarise_draws(
  sfin_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
sfin_estimates <- sfin_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Pd` = max(mean(value > 0), mean(value < 0)),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
sfin_summary_df <- left_join(sfin_estimates, sfin_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
sfin_summary_df_cleaned <- sfin_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Pd`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

sfin_gt_table <- sfin_summary_df_cleaned %>%
  mutate(Significant = Pd >= 0.95) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Pd", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Surface Fierline Intensity")

# Print the table
print(sfin_gt_table)

# Save the final table to a Word document
gtsave(
  sfin_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/S_Fin_Posterior_Table.docx"
)
```


## Fireline Intensity Conditional Effects
```{r conditional_effects_S_FI, echo=FALSE}
# Calculate conditional effects and extract the data frame
SFin_ce_Status <- conditional_effects(S_Fin_model_student, effects = "Status")
SFin_df_Status <- SFin_ce_Status[["Status"]]

# Re-level the factor for plotting
SFin_df_Status$Status <- factor(SFin_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(SFin_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Surface Fireline Intensity by Invasion Status",
    x = "Invasion Status",
    y = expression("Surface Fireline Intensity (kW/m)"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```




## GLMM Crown Transition Ratio
```{r GLMM_Crown_Transition_Ratio, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")


C_TR_model_student <- brm(
  C_TR ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)
```

## Crown Transition Ratio Model Comparison
```{r compare_Crown_TR, echo=FALSE}
summary(C_TR_model_student)

# Plot the posterior predictive checks
pp_check(C_TR_model_student) +
  labs(title = "Posterior Predictive Check for Crown Fire Transition Ratio") +
  theme_minimal()

```

## Transition Ratio Table
```{r transition_ratio_table, echo=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
ctr_draws_filtered <- as_draws_df(C_TR_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
ctr_diagnostics <- summarise_draws(
  ctr_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
ctr_estimates <- ctr_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Pd` = max(mean(value > 0), mean(value < 0)),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
ctr_summary_df <- left_join(ctr_estimates, ctr_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
ctr_summary_df_cleaned <- ctr_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Pd`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

ctr_gt_table <- ctr_summary_df_cleaned %>%
  mutate(Significant = Pd >= 0.95) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Pd", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Crown Transition Ratio")

# Print the table
print(ctr_gt_table)

# Save the final table to a Word document
gtsave(
  ctr_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/C_TR_Posterior_Table.docx"
)

```


## Crown Transition Ratio Conditional Effects
```{r conditional_effects_Crown_TR, echo=FALSE}
# Calculate conditional effects and extract the data frame
CTR_ce_Status <- conditional_effects(C_TR_model_student, effects = "Status")
CTR_df_Status <- CTR_ce_Status[["Status"]]

# Re-level the factor for plotting
CTR_df_Status$Status <- factor(CTR_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(CTR_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Crown Fire Transition Ratio by Invasion Status",
    x = "Invasion Status",
    y = expression("Crown Fire Transition Ratio"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```


## GLMM Crown Fire Active Ratio
```{r GLMM_Crown_Fire_Active_Ratio, eval=FALSE, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")

C_AR_model_student <- brm(
  C_AR ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)

```

## Crown Fire Active Ratio Model Comparison
```{r compare_Crown_AR, eval=FALSE, include=FALSE}
summary(C_AR_model_student)

# Plot the posterior predictive checks
pp_check(C_AR_model_student) +
  labs(title = "Posterior Predictive Check for Crown Fire Active Ratio") +
  theme_minimal()

```

## Active Ratio Table
```{r active_ratio_table, eval=FALSE, include=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
car_draws_filtered <- as_draws_df(C_AR_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
car_diagnostics <- summarise_draws(
  car_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
car_estimates <- car_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Pd` = max(mean(value > 0), mean(value < 0)),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
car_summary_df <- left_join(car_estimates, car_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
car_summary_df_cleaned <- car_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Pd`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

car_gt_table <- car_summary_df_cleaned %>%
  mutate(
    Significant = (`95% HPDI (Lower)` > 0 | `95% HPDI (Upper)` < 0)
  ) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Pd", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Crown Active Ratio")

# Print the table
print(car_gt_table)

# Save the final table to a Word document
gtsave(
  car_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/C_AR_Posterior_Table.docx"
)

```


## Active Ratio Conditional Effects
```{r conditional_effects_Crown_AR, eval=FALSE, include=FALSE}
# Calculate conditional effects and extract the data frame
CAR_ce_Status <- conditional_effects(C_AR_model_student, effects = "Status")
CAR_df_Status <- CAR_ce_Status[["Status"]]

# Re-level the factor for plotting
CAR_df_Status$Status <- factor(CAR_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(CAR_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Crown Fire Active Ratio by Invasion Status",
    x = "Invasion Status",
    y = expression("Crown Fire Active Ratio"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )

```


## GLMM Crown Fire Rate of Spread
```{r GLMM_Crown_Fire_Rate_of_Spread, eval=FALSE, include=FALSE}

fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")


C_ROS_model_student <- brm(
  C_ROS ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)
```

## Crown Fire Rate of Spread Model Comparison
```{r compare_Crown_ROS, eval=FALSE, include=FALSE}
summary(C_ROS_model_student)

# Plot the posterior predictive checks
pp_check(C_ROS_model_student) +
  labs(title = "Posterior Predictive Check for Crown Rate of Spread Model") +
  theme_minimal()

```

## Crown Fire Rate of Spread Table
```{r crown_ROS_table, eval=FALSE, include=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
cros_draws_filtered <- as_draws_df(C_ROS_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
cros_diagnostics <- summarise_draws(
  cros_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
cros_estimates <- cros_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Probability > 0` = mean(value > 0),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
cros_summary_df <- left_join(cros_estimates, cros_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
cros_summary_df_cleaned <- cros_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Probability > 0`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

cros_gt_table <- cros_summary_df_cleaned %>%
  mutate(
    Significant = (`95% HPDI (Lower)` > 0 | `95% HPDI (Upper)` < 0)
  ) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Probability > 0", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Crown Rate of Spread")

# Print the table
print(cros_gt_table)

# Save the final table to a Word document
gtsave(
  cros_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/C_ROS_Posterior_Table.docx"
)
```

## Crown Fire Rate of Spread Conditional Effects
```{r conditional_effects_Crown_ROS, eval=FALSE, include=FALSE}
# Calculate conditional effects and extract the data frame
CROS_ce_Status <- conditional_effects(C_ROS_model_student, effects = "Status")
CROS_df_Status <- CROS_ce_Status[["Status"]]

# Re-level the factor for plotting
CROS_df_Status$Status <- factor(CROS_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(CROS_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Crown Rate of Spread by Invasion Status",
    x = "Invasion Status",
    y = expression("Crown Rate of Spread (m min"^-1*")"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```


## GLMM Crown Fire Intensity
```{r GLMM_Crown_Fire_Intensity, eval=FALSE, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")

C_Fin_model_student <- brm(
  C_Fin ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)

```

## Crown Fire Intensity Model Comparison
```{r compare_Crown_Fin, eval=FALSE, include=FALSE}
summary(C_Fin_model_student)

# Plot the posterior predictive checks
pp_check(C_Fin_model_student) +
  labs(title = "Posterior Predictive Check for Crown Fire Intensity Model") +
  theme_minimal()

```

## Crown Fire Intensity Table
```{r crown_FI_table, eval=FALSE, include=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
cfin_draws_filtered <- as_draws_df(C_Fin_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
cfin_diagnostics <- summarise_draws(
  cfin_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
cfin_estimates <- cfin_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Probability > 0` = mean(value > 0),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
cfin_summary_df <- left_join(cfin_estimates, cfin_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
cfin_summary_df_cleaned <- cfin_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Probability > 0`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

cfin_gt_table <- cfin_summary_df_cleaned %>%
  mutate(
    Significant = (`95% HPDI (Lower)` > 0 | `95% HPDI (Upper)` < 0)
  ) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Probability > 0", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Crown Fireline Intensity")

# Print the table
print(cfin_gt_table)

# Save the final table to a Word document
gtsave(
  cfin_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/C_Fin_Posterior_Table.docx"
)


```


## Crown Fire Intensity Conditional Effects
```{r conditional_effects_Crown_Fin, eval=FALSE, include=FALSE}
# Calculate conditional effects and extract the data frame
CFin_ce_Status <- conditional_effects(C_Fin_model_student, effects = "Status")
CFin_df_Status <- CFin_ce_Status[["Status"]]

# Re-level the factor for plotting
CFin_df_Status$Status <- factor(CFin_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(CFin_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Crown Fire Intensity by Invasion Status",
    x = "Invasion Status",
    y = expression("Crown Fire Intensity (kW m"^-1*")"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
```




## GLMM Crown Fire Flame Length
```{r GLMM_Crown_Fire_Flame_Length, eval=FALSE, include=FALSE}
fb$Status <- relevel(factor(fb$Status), ref = "Non_Invaded")


C_FL_model_student <- brm(
  C_FL ~ Status,
  data = fb,
  family = student(),
  prior = priors,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  control = list(adapt_delta = 0.95)
)
```

## Crown Fire Flame Length Model Comparison
```{r compare_Crown_FL, eval=FALSE, include=FALSE}
summary(C_FL_model_student)

# Plot the posterior predictive checks
pp_check(C_FL_model_student) +
  labs(title = "Posterior Predictive Check for Crown Flame Length Model") +
  theme_minimal()

```

## Crown Flame Length Table
```{r crown_fl_table, eval=FALSE, include=FALSE}
# --- 1. Extract draws and filter parameters of interest ---
cfl_draws_filtered <- as_draws_df(C_FL_model_student) %>%
  select(starts_with("b_"))

# --- 2. Calculate diagnostics ---
cfl_diagnostics <- summarise_draws(
  cfl_draws_filtered,
  "R-hat" = rhat,
  "Bulk ESS" = ess_bulk,
  "Tail ESS" = ess_tail
)

# --- 3. Calculate estimates ---
cfl_estimates <- cfl_draws_filtered %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",  
    values_to = "value"     
  ) %>%
  group_by(variable) %>%
  summarise(
    Estimate = median(value),
    `Est. Error` = mad(value),
    HPDI_lower = hdi(value, ci = 0.95)$CI_low,
    HPDI_upper = hdi(value, ci = 0.95)$CI_high,
    `Probability > 0` = mean(value > 0),
    .groups = "drop"
  )

# --- 4. Join the estimates and diagnostics ---
cfl_summary_df <- left_join(cfl_estimates, cfl_diagnostics, by = "variable")

# --- 5. Clean, format, and create the gt table ---
cfl_summary_df_cleaned <- cfl_summary_df %>%
  mutate(
    Parameter = gsub("b_", "", variable),
    Parameter = gsub("StatusInvaded", "Status-Invaded", Parameter),
    Parameter = gsub(":", " x ", Parameter)
  ) %>%
  select(
    Parameter, 
    Estimate, 
    `Est. Error`, 
    `HPDI_lower`, 
    `HPDI_upper`,
    `Probability > 0`, 
    `Bulk ESS`, 
    `Tail ESS`, 
    `R-hat`
  ) %>%
  mutate(Parameter = fct_relevel(Parameter, "Intercept")) %>%
  arrange(Parameter) %>%
  rename(
    `95% HPDI (Lower)` = `HPDI_lower`,
    `95% HPDI (Upper)` = `HPDI_upper`
  )

cfl_gt_table <- cfl_summary_df_cleaned %>%
  mutate(
    Significant = (`95% HPDI (Lower)` > 0 | `95% HPDI (Upper)` < 0)
  ) %>%
  gt(rowname_col = "Parameter") %>%
  fmt_number(columns = c("Estimate", "Est. Error", "95% HPDI (Lower)", "95% HPDI (Upper)"), decimals = 2) %>%
  fmt_number(columns = c("Probability > 0", "R-hat"), decimals = 3) %>%
  fmt_number(columns = c("Bulk ESS", "Tail ESS"), decimals = 0, use_seps = TRUE) %>%
  tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = Significant == TRUE)) %>%
  cols_hide(columns = "Significant") %>%
  tab_header(title = "Posterior Estimates for Crown Flame Length")

# Print the table
print(cfl_gt_table)

# Save the final table to a Word document
gtsave(
  cfl_gt_table, 
  "C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/02_Data/Posterior_Probabilities/C_Fl_Posterior_Table.docx"
)

```


## Crown Fire Flame Length Conditional Effects
```{r conditional_effects_Crown_FL, eval=FALSE, include=FALSE}
# Calculate conditional effects and extract the data frame
CFL_ce_Status <- conditional_effects(C_FL_model_student, effects = "Status")
CFL_df_Status <- CFL_ce_Status[["Status"]]

# Re-level the factor for plotting
CFL_df_Status$Status <- factor(CFL_df_Status$Status,
                                levels = c("Non_Invaded", "Invaded"),
                                labels = c("Non-Invaded", "Invaded"))

# Plot
ggplot(CFL_df_Status, aes(x = Status, y = estimate__, color = Status)) +
  # Add points for the mean estimates
  geom_point(size = 4) +
  # Add error bars for the 95% credible interval
  geom_errorbar(aes(ymin = lower__, ymax = upper__), 
                width = 0.15, size = 1) +
  labs(
    title = "Estimated Crown Flame Length by Invasion Status",
    x = "Invasion Status",
    y = expression("Crown Flame Length (m)"),
    color = "Invasion Status"
  ) +
  scale_color_manual(values = c("Non-Invaded" = "#1b9e77", "Invaded" = "#d95f02")) +
  scale_y_continuous(limits = c(0, NA), expand = expansion(mult = c(0, 0.3))) +
  theme_minimal(base_size = 16) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linetype = "dashed"),
    legend.position = "none"
  )
  
```

## Relationship Plots
```{r relationship_plots, echo=FALSE}
my_theme <- theme_minimal(base_size = 14) +        # base font size = 14 pts
  theme(
    axis.title   = element_text(size = 15, face = "bold"),
    axis.text    = element_text(size = 13),
    plot.title   = element_text(size = 16, face = "bold", hjust = 0.5),
    legend.title = element_text(size = 14),
    legend.text  = element_text(size = 13)
  )


# Plot the relationship between invasion status and surface rate of spread
sros_fig <- fb %>%
  ggplot(aes(x = Status, y = S_ROS)) +
  geom_jitter(aes(color = Status),
              width = 0.2,
              alpha = 0.2,
              size = 2) +
  geom_boxplot(aes(fill = Status),
               alpha = 0.4,
               outlier.shape = NA) +
  
  scale_fill_manual(values = c(Invaded = "coral",
                               Non_Invaded = "steelblue")) +
  scale_color_manual(values = c(Invaded = "coral",
                                Non_Invaded = "steelblue")) +
  labs(x = "Invasion Status",
       y = "Surface Fire ROS (m/min)") +
  my_theme

print(sros_fig)


ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/S_ROS_Figure.png", plot = sros_fig, width = 8, height = 6)

# Plot the relationship between invasion status and surface flame length
sfl_fig <- fb %>%
  ggplot(aes(x = Status, y = S_FL)) +
  geom_jitter(aes(color = Status),
              width = 0.2,
              alpha = 0.2,
              size = 2) +
  geom_boxplot(aes(fill = Status),
               alpha = 0.4,
               outlier.shape = NA) +

  scale_fill_manual(values = c(Invaded = "coral",
                               Non_Invaded = "steelblue")) +
  scale_color_manual(values = c(Invaded = "coral",
                                Non_Invaded = "steelblue")) +
  labs(x = "Invasion Status",
       y = "Surface Fire FL (m)") +
  my_theme

print(sfl_fig)

ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/S_FL_Figure.png",
       plot = sfl_fig, width = 8, height = 6)


# Plot the relationship between invasion status and surface fireline intensity
sfin_fig <- fb %>%
  ggplot(aes(x = Status, y = S_Fin)) +
  geom_jitter(aes(color = Status),
              width = 0.2,
              alpha = 0.2,
              size = 2) +
  geom_boxplot(aes(fill = Status),
               alpha = 0.4,
               outlier.shape = NA) +

  scale_fill_manual(values = c(Invaded = "coral",
                               Non_Invaded = "steelblue")) +
  scale_color_manual(values = c(Invaded = "coral",
                                Non_Invaded = "steelblue")) +
  labs(x = "Invasion Status",
       y = "Surface Fin (kW/m)") +
  my_theme

print(sfin_fig)

ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/S_FI_Figure.png",
       plot = sfin_fig, width = 8, height = 6)


# Plot the relationship between invasion status and crown transition ratio
ctr_fig <- fb %>%
  ggplot(aes(x = Status, y = C_TR)) +
  geom_jitter(aes(color = Status),
              width = 0.2,
              alpha = 0.2,
              size = 2) +
  geom_boxplot(aes(fill = Status),
               alpha = 0.4,
               outlier.shape = NA) +

  scale_fill_manual(values = c(Invaded = "coral",
                               Non_Invaded = "steelblue")) +
  scale_color_manual(values = c(Invaded = "coral",
                                Non_Invaded = "steelblue")) +
  labs(x = "Invasion Status",
       y = "Crown Fire TR") +
  my_theme

print(ctr_fig)


# Plot the relationship between invasion status and crown transition ratio
#car_fig <- fb %>%
#  ggplot(aes(x = Status, y = C_AR)) +
#  geom_boxplot(aes(fill = Status), alpha = 0.4) +
#geom_jitter(aes(color = Status), width = 0.2, alpha = 0.3, size = 2) +
#scale_fill_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#scale_color_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#  labs(x = "Invasion Status",
#       y = "Crown Fire AR") +
#  my_theme

#print(car_fig)

#ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/C_AR_Figure.png", plot = car_fig, width = 8, height = 6)

# Plot the relationship between invasion status and crown transition ratio
#cros_fig <- fb %>%
#  ggplot(aes(x = Status, y = C_ROS)) +
# geom_boxplot(aes(fill = Status), alpha = 0.4) +
#geom_jitter(aes(color = Status), width = 0.2, alpha = 0.3, size = 2) +
#scale_fill_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#scale_color_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#  labs(x = "Invasion Status",
#       y = "Crown Fire ROS (m/min)") +
#  my_theme

#print(cros_fig)

#ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/C_ROS_Figure.png", plot = cros_fig, width = 8, height = 6)


# Plot the relationship between invasion status and crown fireline intensity
#cfin_fig <- fb %>%
#  ggplot(aes(x = Status, y = C_Fin)) +
#  geom_boxplot(aes(fill = Status), alpha = 0.4) +
#geom_jitter(aes(color = Status), width = 0.2, alpha = 0.3, size = 2) +
#scale_fill_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#scale_color_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#  labs(x = "Invasion Status",
#       y = "Crown Fin (kW/m)") +
#  my_theme

#print(cfin_fig)

#ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/C_FI_Figure.png", plot = cfin_fig, width = 8, height = 6)

# Plot the relationship between invasion status and crown fire flame length
#cfl_fig <- fb %>%
#  ggplot(aes(x = Status, y = C_FL)) +
#  geom_boxplot(aes(fill = Status), alpha = 0.4) +
#geom_jitter(aes(color = Status), width = 0.2, alpha = 0.3, size = 2) +
#scale_fill_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#scale_color_manual(values = c(Invaded = "coral", Non_Invaded = "steelblue")) +
#  labs(x = "Invasion Status",
#       y = "Crown Fire FL (m)") +
#  my_theme

#print(cfl_fig)

#ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/C_FL_Figure.png", plot = cfl_fig, width = 8, height = 6)
```

## Combined Figure
```{r combined_figure, echo=FALSE}
# put all the single plots into a list
plots <- list(
  sros_fig,
  sfl_fig,
  sfin_fig,
  ctr_fig
#  car_fig,
#  cros_fig,
#  cfin_fig,
#  cfl_fig
)

# Hide x-axis for the entire first row (plots 1â€“4)
no_x <- theme(
  axis.title.x = element_blank(),
  axis.text.x  = element_blank(),
  axis.ticks.x = element_blank()
)
plots[1:4] <- lapply(plots[1:4], `+`, no_x)   # remove x axis on top row

fireB_patchwork <-
  (plots[[1]] | plots[[2]]) /
  (plots[[3]] | plots[[4]]) +
  plot_layout(guides = "collect") +
  plot_annotation(tag_levels = "A") +
  theme(plot.margin = margin(5, 5, 5, 5))
# 
fireB_patchwork


#----------------------------------------------------------
# save to file
#----------------------------------------------------------
ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/Combined_Fire_Behavior_Figure.png", plot = fireB_patchwork, width = 16, height = 12)
```


## Updated Plot
```{r updated_plot, echo=FALSE}

fb$Status <- factor(fb$Status,
                     levels = c("Non_Invaded", "Invaded"),
                     labels = c("Non-Invaded", "Invaded"))

#----------------------------------------------------------
# Updated theme for readability
#----------------------------------------------------------
my_theme <- theme_minimal(base_size = 18) +
  theme(
    axis.title   = element_text(size = 26, face = "bold"),
    axis.text    = element_text(size = 24),
    axis.text.x  = element_text(size = 24, face = "bold"),
    axis.line    = element_line(color = "black", linewidth = 0.8),
    axis.ticks   = element_line(color = "black", linewidth = 0.6),

    plot.title   = element_text(size = 22, face = "bold", hjust = 0.5),

    legend.title = element_text(size = 20, face = "bold"),
    legend.text  = element_text(size = 18),

    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "grey75", linewidth = 0.9),
    panel.grid.minor.y = element_line(color = "grey88", linewidth = 0.5),

    plot.tag     = element_text(size = 24, face = "bold")
  )

#----------------------------------------------------------
# Function to make individual plots
#----------------------------------------------------------
make_fire_plot <- function(df, yvar, ylab){
  ggplot(df, aes(x = Status, y = .data[[yvar]])) +
    geom_jitter(aes(color = Status),
                width = 0.2,
                alpha = 0.1,
                size = 2) +
    geom_boxplot(aes(fill = Status),
                 alpha = 0.9,
                 outlier.shape = NA) +

    scale_fill_manual(values = c(Invaded = "coral",
                                 'Non-Invaded' = "steelblue")) +
    scale_color_manual(values = c(Invaded = "coral",
                                  'Non-Invaded' = "steelblue")) +
    labs(x = "Invasion Status", y = ylab) +
    my_theme
}


#----------------------------------------------------------
# Create all plots
#----------------------------------------------------------
sros_fig <- make_fire_plot(fb, "S_ROS", "Surface Fire ROS (m/min)")
sfl_fig  <- make_fire_plot(fb, "S_FL",  "Surface Fire FL (m)")
sfin_fig <- make_fire_plot(fb, "S_Fin", "Surface FI (kW/m)")
ctr_fig  <- make_fire_plot(fb, "C_TR",  "Crown Fire TR")

# Save individual plots
ggsave("S_ROS_Figure.png", plot = sros_fig, width = 8, height = 6)
ggsave("S_FL_Figure.png",  plot = sfl_fig, width = 8, height = 6)
ggsave("S_FI_Figure.png",  plot = sfin_fig, width = 8, height = 6)
ggsave("C_TR_Figure.png",  plot = ctr_fig, width = 8, height = 6)

#----------------------------------------------------------
# Combine plots with patchwork
#----------------------------------------------------------
plots <- list(sros_fig, sfl_fig, sfin_fig, ctr_fig)

# Hide x-axis for top row
no_x <- theme(
  axis.title.x = element_blank(),
  axis.text.x  = element_blank(),
  axis.ticks.x = element_blank()
)
plots[1:2] <- lapply(plots[1:2], `+`, no_x)  

fireB_patchwork <- 
  (plots[[1]] | plots[[2]]) /
  (plots[[3]] | plots[[4]]) +
  plot_layout(guides = "collect") +
  plot_annotation(tag_levels = "A") +
  theme(plot.margin = margin(5, 5, 5, 5))

# Show combined figure
fireB_patchwork

# Save combined figure
ggsave("C:/Users/DrewIvory/OneDrive - University of Florida/Desktop/School/PHD/01_Projects/01_FuelDynamics/03_Figure/O2/Combined_Fire_Behavior_Figure.png", plot = fireB_patchwork, width = 16, height = 12)

```
